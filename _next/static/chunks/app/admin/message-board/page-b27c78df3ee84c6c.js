(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[243],{8933:(e,r,s)=>{Promise.resolve().then(s.bind(s,716))},716:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>h});var t=s(5155),a=s(2115),l=s(8173),n=s.n(l),i=s(4085),c=s(5007),o=s(434),d=s(9602);let m=a.forwardRef((e,r)=>{let{className:s,orientation:a="horizontal",decorative:l=!0,...n}=e;return(0,t.jsx)(o.b,{ref:r,decorative:l,orientation:a,className:(0,d.cn)("shrink-0 bg-border","horizontal"===a?"h-[1px] w-full":"h-full w-[1px]",s),...n})});m.displayName=o.b.displayName;var x=s(674);let u=a.forwardRef((e,r)=>{let{className:s,children:a,...l}=e;return(0,t.jsxs)(x.bL,{ref:r,className:(0,d.cn)("relative overflow-hidden",s),...l,children:[(0,t.jsx)(x.LM,{className:"h-full w-full rounded-[inherit]",children:a}),(0,t.jsx)(f,{}),(0,t.jsx)(x.OK,{})]})});u.displayName=x.bL.displayName;let f=a.forwardRef((e,r)=>{let{className:s,orientation:a="vertical",...l}=e;return(0,t.jsx)(x.VM,{ref:r,orientation:a,className:(0,d.cn)("flex touch-none select-none transition-colors","vertical"===a&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===a&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...l,children:(0,t.jsx)(x.lr,{className:"relative flex-1 rounded-full bg-border"})})});f.displayName=x.VM.displayName;var p=s(814);function h(){let[e,r]=(0,a.useState)([]),[s,l]=(0,a.useState)(!1),[o,d]=(0,a.useState)({total:0,public:0,private:0}),x=async()=>{l(!0);try{let e=await fetch("/api/admin/messages"),s=e.headers.get("content-type");if(!s||!s.includes("application/json")){let r=await e.text();console.error("API返回了非JSON响应:",r),p.oR.error("API返回格式错误，请检查控制台"),l(!1);return}let t=await e.json();t.success?(r(t.data),d({total:t.data.length,public:t.publicCount,private:t.privateCount})):(console.error("获取留言失败:",t.message),console.error("错误详情:",t.error),t.stack&&console.error("错误堆栈:",t.stack),p.oR.error("获取留言失败: ".concat(t.message||"未知错误")))}catch(e){console.error("获取留言出错:",e),console.error("错误消息:",e.message),e.stack&&console.error("错误堆栈:",e.stack),p.oR.error("获取留言失败: ".concat(e.message||"未知错误"))}finally{l(!1)}},f=async s=>{if(confirm("确定要删除这条留言吗？此操作不可撤销。"))try{let t=await fetch("/api/messages/".concat(s),{method:"DELETE"}),a=await t.json();a.success?(p.oR.success("留言已成功删除"),r(e.filter(e=>e._id!==s)),d(e=>({total:e.total-1,public:a.data.isPublic?e.public-1:e.public,private:a.data.isPublic?e.private:e.private-1}))):p.oR.error("删除失败: ".concat(a.message))}catch(e){console.error("删除留言失败:",e),p.oR.error("删除失败: ".concat(e.message||"未知错误"))}},h=e=>new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});return(0,a.useEffect)(()=>{x()},[]),(0,t.jsxs)("div",{className:"w-full max-w-6xl mx-auto py-8 px-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,t.jsx)(n(),{href:"/",children:(0,t.jsxs)(i.$,{variant:"outline",className:"flex items-center gap-2",children:[(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"})}),"返回主页"]})}),(0,t.jsx)("h1",{className:"text-3xl font-bold text-center",children:"留言管理"}),(0,t.jsx)("div",{className:"w-[105px]"})," "]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[(0,t.jsxs)(c.Zp,{className:"p-4 bg-blue-50",children:[(0,t.jsx)("h3",{className:"text-lg font-medium",children:"总留言数"}),(0,t.jsx)("p",{className:"text-3xl font-bold",children:o.total})]}),(0,t.jsxs)(c.Zp,{className:"p-4 bg-green-50",children:[(0,t.jsx)("h3",{className:"text-lg font-medium",children:"公开留言"}),(0,t.jsx)("p",{className:"text-3xl font-bold",children:o.public})]}),(0,t.jsxs)(c.Zp,{className:"p-4 bg-yellow-50",children:[(0,t.jsx)("h3",{className:"text-lg font-medium",children:"非公开留言"}),(0,t.jsx)("p",{className:"text-3xl font-bold",children:o.private})]})]}),(0,t.jsxs)(c.Zp,{className:"p-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"留言列表"}),(0,t.jsx)(i.$,{onClick:x,disabled:s,children:s?"加载中...":"刷新"})]}),s?(0,t.jsx)("div",{className:"text-center py-8",children:"加载中..."}):0===e.length?(0,t.jsx)("div",{className:"text-center py-8 text-gray-500",children:"暂无留言"}):(0,t.jsx)(u,{className:"h-[600px] pr-4",children:(0,t.jsx)("div",{className:"space-y-6",children:e.map(e=>(0,t.jsxs)("div",{className:"p-4 rounded-lg ".concat(e.isPublic?"bg-green-50":"bg-yellow-50"),children:[(0,t.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("h3",{className:"font-medium",children:e.name}),(0,t.jsx)("span",{className:"px-2 py-0.5 text-xs rounded-full ".concat(e.isPublic?"bg-green-200 text-green-800":"bg-yellow-200 text-yellow-800"),children:e.isPublic?"公开":"非公开"})]}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:h(e.createdAt)})]}),(0,t.jsx)("div",{className:"flex gap-2",children:(0,t.jsx)(i.$,{variant:"destructive",size:"sm",onClick:()=>f(e._id),children:"删除"})})]}),(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:["邮箱：",e.email]}),(0,t.jsx)("p",{className:"mt-2 text-gray-700 whitespace-pre-line",children:e.content}),(0,t.jsx)(m,{className:"mt-4"})]},e._id))})})]})]})}},4085:(e,r,s)=>{"use strict";s.d(r,{$:()=>o});var t=s(5155),a=s(2115),l=s(2317),n=s(1027),i=s(9602);let c=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),o=a.forwardRef((e,r)=>{let{className:s,variant:a,size:n,asChild:o=!1,...d}=e,m=o?l.DX:"button";return(0,t.jsx)(m,{className:(0,i.cn)(c({variant:a,size:n,className:s})),ref:r,...d})});o.displayName="Button"},5007:(e,r,s)=>{"use strict";s.d(r,{Wu:()=>i,Zp:()=>n});var t=s(5155),a=s(2115),l=s(9602);let n=a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)("div",{ref:r,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...a})});n.displayName="Card",a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)("div",{ref:r,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",s),...a})}).displayName="CardHeader",a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)("div",{ref:r,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",s),...a})}).displayName="CardTitle",a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)("div",{ref:r,className:(0,l.cn)("text-sm text-muted-foreground",s),...a})}).displayName="CardDescription";let i=a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)("div",{ref:r,className:(0,l.cn)("p-6 pt-0",s),...a})});i.displayName="CardContent",a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)("div",{ref:r,className:(0,l.cn)("flex items-center p-6 pt-0",s),...a})}).displayName="CardFooter"},9602:(e,r,s)=>{"use strict";s.d(r,{cn:()=>l});var t=s(3463),a=s(9795);function l(){for(var e=arguments.length,r=Array(e),s=0;s<e;s++)r[s]=arguments[s];return(0,a.QP)((0,t.$)(r))}}},e=>{var r=r=>e(e.s=r);e.O(0,[425,374,441,517,358],()=>r(8933)),_N_E=e.O()}]);